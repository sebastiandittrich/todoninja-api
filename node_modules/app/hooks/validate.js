const hydrate = require('feathers-sequelize/hooks/hydrate')

module.exports = function() {
  return async context => {

    if([ 'create', 'update', 'patch' ].includes(context.method)) {
      // Handle multiple model insert, update and remove
      const data = Array.isArray(context.data) ? context.data : [context.data]
      const Model = context.service.Model

      // Run in parallel
      await Promise.all(data.map( item => Model.build(item).validate() ))
    }

    return context

  }
}
