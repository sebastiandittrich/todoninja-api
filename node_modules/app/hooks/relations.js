module.exports = {

  hasMany(...propnames) {
    return async context => {
      const result = Array.isArray(context.result.data) ? context.result.data : [context.result.data]

      result[0].lol = 'test'

      await Promise.all(result.map(async item => {
        await Promise.all(propnames.map(async propname => {
          const associations = await context.service.Model.build(item)['get' + propname]({ attributes: [ 'id' ] })
          item[propname.toLowerCase()] = associations.map(otheritem => otheritem.id)
        }))
      }))

      return context

    }
  }

}
